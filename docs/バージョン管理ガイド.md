# バージョン管理ガイド

## 現在のバージョン管理システム

### 自動化されている部分 ✅
- **Webアプリのバージョン表示**: `package.json` → 自動表示
- **Service Worker**: `package.json` → ビルド時に自動生成

### 手動更新が必要な部分 ⚠️
- **Android versionCode**: `app/build.gradle`
- **Android versionName**: `app/build.gradle`

## バージョンアップ手順

### 1. package.jsonを更新
```bash
# パッチバージョン（バグ修正）
npm version patch  # 20.0.0 → 20.0.1

# マイナーバージョン（機能追加）
npm version minor  # 20.0.0 → 20.1.0

# メジャーバージョン（破壊的変更）
npm version major  # 20.0.0 → 21.0.0
```

### 2. Android側を手動更新
`app/build.gradle` を編集:
```gradle
versionCode 21  # 整数で1つずつ増加
versionName "20.1.0"  # package.jsonと同じ
```

### 3. ビルド実行
```bash
npm run build  # Service Workerが自動生成される
```

## バージョン番号のルール

### セマンティックバージョニング
- **MAJOR.MINOR.PATCH** 形式
- **MAJOR**: 破壊的変更（UIの大幅変更、データ構造変更など）
- **MINOR**: 機能追加（新カテゴリ追加、新機能追加など）
- **PATCH**: バグ修正（不具合修正、軽微な調整など）

### Android versionCode
- **整数**で管理（Google Playの制約）
- **一度使ったら戻せない**
- 基本的に1つずつ増加: 20, 21, 22, 23...

## 注意事項

### Google Play Console
- versionCodeは**必ず増加**させる
- 一度アップロードしたversionCodeは再利用不可
- versionNameは表示用なので自由に設定可能

### Service Worker
- ビルド時に自動生成されるため**手動編集禁止**
- `public/sw.js`ファイルは存在しない（自動生成）
- キャッシュ名は`quiz-rpg-v{バージョン番号}`形式

## トラブルシューティング

### Service Workerが更新されない
1. ブラウザのキャッシュをクリア
2. DevToolsでService Workerを手動削除
3. `npm run build`を再実行

### Android版でバージョンエラー
1. versionCodeが前回より大きいか確認
2. Google Play Consoleで使用済みversionCodeを確認
3. 必要に応じてversionCodeを大きく設定

## 履歴管理

### 現在のバージョン: 20.0.0
- package.json: 20.0.0
- Android versionCode: 20
- Android versionName: 20.0.0
- Service Worker: v2000（20.0.0から自動生成）

### 更新履歴
- v19.0.1: DataLossWarning削除、バージョン表示機能追加
- v20.0.0: 広告IDエラー修正、バージョン管理統一 