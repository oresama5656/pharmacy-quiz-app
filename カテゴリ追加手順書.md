# 薬学クイズアプリ - カテゴリ追加手順書

## はじめに
このガイドでは、薬学クイズアプリに新しいカテゴリを追加する方法を説明します。
2024年12月版の新しい統合管理システムに対応しています。

## 必要なもの
- テキストエディタ（Visual Studio Codeなど）
- 基本的なJSONの知識

## 新しいファイル構造
```
src/data/
├── categories.json          # カテゴリ情報（メタデータ）
├── guilds.json             # ギルド定義
├── quizManager.ts          # 自動インポート管理
└── quizzes/               # クイズファイル置き場
    ├── brand2generic.json  # 基本クイズ
    ├── math/              # 数学クイズ
    │   └── lv1_*.json
    └── english/           # 英語クイズ
        └── english_*.json
```

## 手順（3ステップ）

### ステップ1：クイズファイルを作成する

1. **ファイル配置**
   - `src/data/quizzes/` フォルダに新しいJSONファイルを作成
   - 例：`heart_medicine.json`（循環器系薬物のクイズ）
   - サブフォルダも可能：`quizzes/cardiology/heart_medicine.json`

2. **クイズデータの形式**
```json
[
  {
    "question": "質問文をここに書く",
    "correct": "正解をここに書く",
    "choices": ["選択肢1", "選択肢2", "選択肢3", "選択肢4"]
  },
  {
    "question": "2つ目の質問",
    "correct": "2つ目の正解",
    "choices": ["選択肢1", "選択肢2", "選択肢3", "選択肢4"]
  }
]
```

3. **注意点**
   - 最低5問程度のクイズを作成
   - 正解は必ず選択肢の中に含める
   - 数学系クイズの場合、数値は数値型でも文字列でもOK（自動変換されます）

### ステップ2：カテゴリ情報を追加する

1. **`src/data/categories.json` を編集**
2. **配列の最後に新しいカテゴリを追加**

```json
{
  "id": "heart_medicine",
  "name": "循環器系薬物",
  "description": "循環器系に作用する薬物に関する問題です",
  "icon": "❤️",
  "difficulty": "★★",
  "clearFloor": 15,
  "file": "quizzes/heart_medicine.json"
}
```

**各項目の説明：**
- `id`: 一意の識別子（英数字とアンダースコア）
- `name`: カテゴリの表示名
- `description`: カテゴリの説明文
- `icon`: 絵文字（一文字）
- `difficulty`: `★`（基本）から`★★★★★`（最高難度）
- `clearFloor`: クリア目標階層数
- `file`: クイズファイルのパス（`quizzes/`からの相対パス）

### ステップ3：quizManager.tsにインポートを追加する

1. **`src/data/quizManager.ts` を編集**
2. **インポート部分に追加**

```typescript
// 既存のインポートの後に追加
import heart_medicine from './quizzes/heart_medicine.json';
```

3. **quizImportMapに追加**

```typescript
// 静的インポートマップ
const quizImportMap: Record<string, any> = {
  // 既存のマッピング...
  'quizzes/heart_medicine.json': heart_medicine,
};
```

### ステップ4：ギルドに追加する（オプション）

新しいカテゴリを既存のギルドに追加したい場合：

1. **`src/data/guilds.json` を編集**
2. **該当ギルドの`categoryIds`配列に追加**

```json
{
  "id": "pharmacy",
  "name": "調剤ギルド",
  "icon": "💊",
  "position": { "top": "30%", "left": "25%" },
  "categoryIds": [
    "brand2generic",
    "brand2effect",
    "generic2effect",
    "brand2generic_diabetes",
    "antibiotics",
    "heart_medicine"  // ← 新しく追加
  ]
}
```

## 完全な例：高血圧薬カテゴリの追加

### 1. クイズファイル作成
`src/data/quizzes/hypertension.json`
```json
[
  {
    "question": "アムロジピンの薬効分類は？",
    "correct": "カルシウム拮抗薬",
    "choices": ["カルシウム拮抗薬", "ACE阻害薬", "ARB", "利尿薬"]
  },
  {
    "question": "カンデサルタンの薬効分類は？",
    "correct": "ARB",
    "choices": ["カルシウム拮抗薬", "ACE阻害薬", "ARB", "β遮断薬"]
  },
  {
    "question": "エナラプリルの薬効分類は？",
    "correct": "ACE阻害薬",
    "choices": ["カルシウム拮抗薬", "ACE阻害薬", "ARB", "利尿薬"]
  }
]
```

### 2. カテゴリ情報追加
`src/data/categories.json`に追加：
```json
{
  "id": "hypertension",
  "name": "高血圧治療薬",
  "description": "高血圧治療に使われる薬物の分類問題",
  "icon": "💊",
  "difficulty": "★★",
  "clearFloor": 10,
  "file": "quizzes/hypertension.json"
}
```

### 3. インポート追加
`src/data/quizManager.ts`に追加：
```typescript
// インポート部分
import hypertension from './quizzes/hypertension.json';

// マップ部分
const quizImportMap: Record<string, any> = {
  // 既存のマッピング...
  'quizzes/hypertension.json': hypertension,
};
```

### 4. ギルドに追加
`src/data/guilds.json`の調剤ギルドに追加：
```json
{
  "id": "pharmacy",
  "categoryIds": [
    "brand2generic",
    "brand2effect",
    "generic2effect",
    "brand2generic_diabetes",
    "antibiotics",
    "hypertension"
  ]
}
```

## 新しいギルドを作成する場合

### guilds.jsonに新しいギルドを追加
```json
{
  "id": "cardiology",
  "name": "循環器ギルド",
  "icon": "❤️",
  "position": { "top": "15%", "left": "75%" },
  "categoryIds": ["hypertension", "heart_medicine", "arrhythmia"]
}
```

## 確認とテスト

1. **アプリを起動**
   ```bash
   npm run dev
   ```

2. **確認項目**
   - ギルドマップに新しいギルドが表示される
   - ギルドをクリックしてクエストボードが開く
   - 新しいカテゴリが表示される
   - カテゴリを選択してクイズが正常に動作する

## トラブルシューティング

### よくあるエラー

1. **「Quiz file not found in import map」**
   - `quizImportMap`にファイルパスが正しく登録されているか確認
   - インポート文が正しく書かれているか確認

2. **「Cannot find module」**
   - クイズファイルが正しい場所に配置されているか確認
   - ファイル名が正しいか確認

3. **カテゴリが表示されない**
   - `categories.json`の書式が正しいか確認
   - `guilds.json`の`categoryIds`に追加されているか確認

## 旧システムからの変更点

- ✅ **簡素化**: 3ファイル修正 → 2-3ファイル修正
- ✅ **統合管理**: カテゴリとギルドが分離され管理しやすい
- ✅ **型安全**: TypeScriptの恩恵を受けられる
- ✅ **パフォーマンス**: 静的インポートで高速読み込み

これで新しいカテゴリの追加が完了です！🎉 